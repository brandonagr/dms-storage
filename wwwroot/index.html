<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>DMS Storage Ticket</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/one-page-wonder.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">DMS Project Storage</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="#print">Print Ticket</a>
                    </li>
                    <li>
                        <a href="#rules">Rules</a>
                    </li>
                    <li>
                        <a href="#contact">Contact</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Content -->
    <div class="container">

        <div class="featurette" id="print">
            <h2 class="featurette-heading">Print storage ticket</h2>
            <p>A ticket is <span style="color:darkred">REQUIRED</span> on anything left at DMS</p>
            <form class="form-horizontal span" id="form" method="post">

                <div class="form-group">
                    <label for="name" class="col-lg-2 control-label">Name</label>
                    <div class="col-lg-3">
                        <input type="text" class="form-control" name="name" placeholder="Name">
                    </div>
                </div>

                <div class="form-group">
                    <label for="email" class="col-lg-2 control-label">Email</label>
                    <div class="col-lg-3">
                        <input type="text" class="form-control" name="email" placeholder="Email">
                    </div>
                </div>

                <div class="form-group">
                    <label for="desc" class="col-lg-2 control-label">Description</label>
                    <div class="col-lg-5">
                        <input type="text" class="form-control" name="description" placeholder="Short description of project being stored">
                    </div>
                </div>

                <div class="form-group">
                    <label for="type" class="col-lg-2 control-label">Storage Type</label>
                    <div class="col-lg-3">
                        <select class="form-control" name="storageType">
                            <option selected value="Small Shelf">Small Shelf</option>
                            <option value="Large Shelf">Large Shelf</option>
                            <option value="Vertical">Vertical</option>
                            <option value="Pallet">Pallet</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-lg-7 col-md-offset-2">
                        <div id="messages"></div>
                    </div>
                </div>

                <div class="form-group">
                    <span class="col-lg-2"></span>
                    <div class="col-lg-5">
                        <button class="btn btn-primary" type="submit" id="submit">Print Ticket that expires on <span id="expireDate">NEXT FIRST SUNDAY OF MONTH</span></button>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-lg-7 col-md-offset-2">
                        <div id="result" class="error"></div>
                    </div>
                </div>
            </form>

            <p>You agree to remove your item before <span id="expireDate">NEXT FIRST SUNDAY OF MONTH</span> or attend the monthly
                storage meeting to request an extension</p>
        </div>

        <hr class="featurette-divider">

        <!-- First Featurette -->
        <div class="featurette" id="rules">
            <h2 class="featurette-heading">Project Storage Rules</h2>
            <p>The Logistics Committee hosts the Dallas Makerspace's Storage Meeting on a monthly basis - typically on the first
                Sunday of each month at 4PM in the Conference room. At this meeting, advice and guidance is given to all
                of the affected operating committees to manage and coordinate a unified and transparent storage policy at
                the Dallas Makerspace. Although each committee technically maintains control over its own area, storage issues
                often transcend the domain of any one committee and the Storage Meeting provides a forum to help coordinate
                these policies.</p>
            <ul>
                <li><b>USING STORAGE:</b> Print out a Storage Ticket, select a slot, and fill it taking care not to present a
                    hazard. Vacate your slot before the printed expiration date, or if you need more time attend a Storage
                    Meeting (or have someone act as an Agent on your behalf).</li>
                <li><b>USING PROJECT STORAGE (shelves):</b> Insert your completed Storage Ticket in the slot, occupy it, and
                    keep your project visually separate from adjacent slots</li>
                <li><b>USING PALLET STORAGE:</b> Load your pallet and park it under the shelves or in pallet storage. Situate
                    materials so they remain stable; expect your pallet to be moved the longer it is at DMS.</li>
                <li><b>USING FLOOR STORAGE:</b> Contact Logistics prior to using floor storage for more than 24 hours.</li>
                <li><b>EXTENSIONS:</b> You or an agent must attend a Storage Meeting (typically 1st Saturday of the month) in
                    person to request an extension</li>
                <li><b>REMOVALS:</b> Projects that have exceeded the date printed on the Storage Ticket will be tagged for removal
                    and members are to remove them by the printed date on the Removal Notice; after this date they may be
                    relocated to Offsite Storage at any time.</li>
                <li><b>DISPOSAL OF PROJECTS:</b> Projects removed to offsite storage may be disposed of 28 days after the date
                    on the Removal Notice.</li>
                <li><b>ACCESSING OFFSITE STORAGE:</b> Assured Self Storage, 2444 Luna Road Carrollton TX, Unit 1000, keys located
                    below Storage Kiosk</li>
            </ul>
        </div>

        <hr class="featurette-divider">

        <!-- Third Featurette -->
        <div class="featurette" id="contact">
            <h2 class="featurette-heading">Contact Logistics</h2>
            <p class="lead">Email logistics@dallasmakerspace.org or attend a Logistics/Storage Meeting.
            </p>
        </div>

    </div>
    <!-- /.container -->

    <!-- jQuery -->
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrapValidator.min.js"></script>

    <script>
        function nthWeekdayOfMonth(weekday, n, date) {
            var count = 0,
                idate = new Date(date.getFullYear(), date.getMonth(), 1, 16);
            while (true) {
                if (idate.getDay() === weekday) {
                    if (++count == n) {
                        break;
                    }
                }
                idate.setDate(idate.getDate() + 1);
            }
            return idate;
        }
        function ordinal_suffix_of(i) {
            var j = i % 10,
                k = i % 100;
            if (j == 1 && k != 11) {
                return i + "st";
            }
            if (j == 2 && k != 12) {
                return i + "nd";
            }
            if (j == 3 && k != 13) {
                return i + "rd";
            }
            return i + "th";
        }
        function formatDate(date) {
            var monthNames = [
                "January", "February", "March",
                "April", "May", "June", "July",
                "August", "September", "October",
                "November", "December"
            ];

            var day = date.getDate();
            var monthIndex = date.getMonth();

            return monthNames[monthIndex] + ' ' + ordinal_suffix_of(day);
        }
        function setDateInText() {
            // set the date
            curDate = new Date()
            expireDate = nthWeekdayOfMonth(0, 1, curDate)
            if (expireDate < curDate) {
                curDate.setMonth(curDate.getMonth() + 1)
                expireDate = nthWeekdayOfMonth(0, 1, curDate)
            }
            $('[id="expireDate"]').text(formatDate(expireDate))
        }

        $(document).ready(function () {

            // setup logging
            var appInsights = window.appInsights || function (config) {
                function i(config) { t[config] = function () { var i = arguments; t.queue.push(function () { t[config].apply(t, i) }) } } var t = { config: config }, u = document, e = window, o = "script", s = "AuthenticatedUserContext", h = "start", c = "stop", l = "Track", a = l + "Event", v = l + "Page", y = u.createElement(o), r, f; y.src = config.url || "https://az416426.vo.msecnd.net/scripts/a/ai.0.js"; u.getElementsByTagName(o)[0].parentNode.appendChild(y); try { t.cookie = u.cookie } catch (p) { } for (t.queue = [], t.version = "1.0", r = ["Event", "Exception", "Metric", "PageView", "Trace", "Dependency"]; r.length;)i("track" + r.pop()); return i("set" + s), i("clear" + s), i(h + a), i(c + a), i(h + v), i(c + v), i("flush"), config.disableExceptionTracking || (r = "onerror", i("_" + r), f = e[r], e[r] = function (config, i, u, e, o) { var s = f && f(config, i, u, e, o); return s !== !0 && t["_" + r](config, i, u, e, o), s }), t
            } ({
                instrumentationKey: "a9d49e5a-9eb5-4ca9-9aad-076b1755cc5b"
            });

            window.appInsights = appInsights;
            appInsights.trackPageView();

            setDateInText()
            setInterval(setDateInText, 60000); // keep text up to date


            // setup bootstrapValidator
            $("#form").bootstrapValidator({
                container: '#messages',
                feedbackIcons: {
                    valid: 'glyphicon glyphicon-ok',
                    invalid: 'glyphicon glyphicon-remove',
                    validating: 'glyphicon glyphicon-refresh'
                },
                fields: {
                    name: {
                        validators: {
                            notEmpty: {
                                message: 'The full name is required and cannot be empty'
                            }
                        }
                    },
                    email: {
                        validators: {
                            notEmpty: {
                                message: 'The email address is required and cannot be empty'
                            },
                            emailAddress: {
                                message: 'The email address is not valid'
                            }
                        }
                    },
                    description: {
                        validators: {
                            notEmpty: {
                                message: 'The description is required and cannot be empty'
                            },
                            stringLength: {
                                max: 144,
                                message: 'The description must be less than 100 characters long'
                            }
                        }
                    }
                }
            }).on('success.form.bv', function (e) {
                e.preventDefault()

                // send ajax
                $.ajax({
                    url: './ticketApi/print', // url where to submit the request
                    type: "POST", // type of action POST || GET
                    dataType: 'json', // data type
                    data: $("#form").serialize(), // post data || get data
                    success: function (result) {

                        console.log(result);

                        window.appInsights.trackEvent("Ticket", { name: $("input[name=name]").val(), email: $("input[name=email]").val(), desc: $("input[name=description]").val(), storageType: $("select[name=storageType]").val() });

                        $("#result").text("");
                        
                        $("#form")
                            .bootstrapValidator('disableSubmitButtons', false)
                            .bootstrapValidator('resetForm', true)
                    },
                    error: function (xhr, resp, text) {
                        console.log(xhr, resp, text);

                        window.appInsights.trackEvent("TicketError", { errorText: xhr.responseText, name: $("input[name=name]").val(), email: $("input[name=email]").val(), desc: $("input[name=description]").val(), storageType: $("select[name=storageType]").val() });

                        $("#result").text("ERROR PRINTING :( " + text + " " + xhr.responseText);
                        $("#submit").removeAttr('disabled');
                    }
                })             
            })
        });
    </script>

</body>

</html>
